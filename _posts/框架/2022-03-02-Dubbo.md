---
layout: post
title: Dubbo
categories: 框架
description: 分布式框架
keywords: 分布式框架
excerpt: Apache Dubbo 是一款微服务开发框架，它提供了 RPC通信 与 微服务治理 两大关键能力。
---

Apache Dubbo 是一款微服务开发框架，它提供了 RPC通信 与 微服务治理 两大关键能力。

### 概念&架构

#### 服务发现

服务发现，即消费端自动发现服务地址列表的能力，是微服务框架需要具备的关键能力，借助于自动化的服务发现，微服务之间可以在无需感知对端部署位置与 IP 地址的情况下实现通信。

实现服务发现的方式有很多种，Dubbo 提供的是一种 Client-Based 的服务发现机制，通常还需要部署额外的第三方注册中心组件来协调服务发现过程，如常用的 Nacos、Consul、Zookeeper 等，Dubbo 自身也提供了对多种注册中心组件的对接，用户可以灵活选择。

<img src="http://qiniuyun.jeesoul.com/img/20220302110845.png" alt="//imgs/architecture.png" style="zoom:50%;" />

服务发现的一个核心组件是注册中心，Provider 注册地址到注册中心，Consumer 从注册中心读取和订阅 Provider 地址列表。 因此，要启用服务发现，需要为 Dubbo 增加注册中心配置，比如zk，nacos等。

Dubbo3新特性：

- Dubbo3 应用级服务发现，以应用粒度组织地址数据
- Dubbo2 接口级服务发现，以接口粒度组织地址数据

Dubbo3 引入的应用级服务发现主要有以下优势：

- 适配云原生微服务变革。
- 提升性能与可伸缩性。

#### 通讯协议

Dubbo3 提供了 Triple(Dubbo3)、Dubbo2 协议，这是 Dubbo 框架的原生协议。

除此之外，Dubbo3 也对众多第三方协议进行了集成，并将它们纳入 Dubbo 的编程与服务治理体系， 包括 gRPC、Thrift、JsonRPC、Hessian2、REST 等。

协议是 RPC 的核心，它规范了数据在网络中的传输内容和格式。除必须的请求、响应数据外，通常还会包含额外控制数据，如单次请求的序列化方式、超时时间、压缩方式和鉴权信息等。

RPC 协议的设计需要考虑以下内容：

- 通用性： 统一的二进制格式，跨语言、跨平台、多传输层协议支持
- 扩展性： 协议增加字段、升级、支持用户扩展和附加业务元数据
- 性能：As fast as it can be
- 穿透性：能够被各种终端设备识别和转发：网关、代理服务器等 通用性和高性能通常无法同时达到，需要协议设计者进行一定的取舍。

#### 流量管理

流量管理的本质是将请求根据制定好的路由规则分发到应用服务上。

Dubbo提供了支持mesh方式的流量管理策略，可以很容易实现 [A/B测试](https://dubbo.apache.org/zh/docs/examples/routing/ab-testing-deployment/)、[金丝雀发布](https://dubbo.apache.org/zh/docs/examples/routing/canary-deployment/)、[蓝绿发布](https://dubbo.apache.org/zh/docs/examples/routing/blue-green-deployment/)等能力。

#### 部署架构

Dubbo 的三大中心化组件：

- **注册中心**。协调 Consumer 与 Provider 之间的地址注册与发现
- **配置中心**。
  - 存储 Dubbo 启动阶段的全局配置，保证配置的跨环境共享与全局一致性
  - 负责服务治理规则（路由规则、动态配置等）的存储与推送。
- **元数据中心**。
  - 接收 Provider 上报的服务接口元数据，为 Admin 等控制台提供运维能力（如服务测试、接口文档等）
  - 作为服务发现机制的补充，提供额外的接口/方法级别配置信息的同步能力，相当于注册中心的额外扩展

<img src="http://qiniuyun.jeesoul.com/img/20220302140624.png"  />

### 对比Springcloud

以下是对比细节：

| 功能组件                                             | Spring Cloud                         | Dubbo Spring Cloud                                   |
| ---------------------------------------------------- | ------------------------------------ | ---------------------------------------------------- |
| 分布式配置（Distributed configuration）              | Git、Zookeeper、Consul、JDBC         | Spring Cloud 分布式配置 + Dubbo 配置中心[6]          |
| 服务注册与发现（Service registration and discovery） | Eureka、Zookeeper、Consul            | Spring Cloud 原生注册中心[7] + Dubbo 原生注册中心[8] |
| 负载均衡（Load balancing）                           | Ribbon（随机、轮询等算法）           | Dubbo 内建实现（随机、轮询等算法 + 权重等特性）      |
| 服务熔断（Circuit Breakers）                         | Spring Cloud Hystrix                 | Spring Cloud Hystrix + Alibaba Sentinel[9] 等        |
| 服务调用（Service-to-service calls）                 | Open Feign、`RestTemplate`           | Spring Cloud 服务调用 + Dubbo `@Reference`           |
| 链路跟踪（Tracing）                                  | Spring Cloud Sleuth[10] + Zipkin[11] | Zipkin、opentracing 等                               |

