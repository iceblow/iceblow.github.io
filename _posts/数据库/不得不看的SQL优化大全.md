[TOC]

## 优化SELECT语句

------

优化查询的主要因素是：

- 为了使慢查询 SELECT COL FROM TABLE WHERE ……查询更快，首先可以检查是否可以添加索引，在WHERE条件中使用的列上设置索引，来加快评估、过滤和检索的速度。为了避免浪费磁盘空间，请设置一组小的索引来加快查询。

  对于使用了JOIN和外键等功能的不同表的查询，索引尤其重要。你可以使用EXPLAIN语句来确定用到的索引。

- 隔离和调整查询中耗时的部分，例如函数调用。根据查询的接口，可以对结果集中的每一行调用一次函数，甚至可以对表中的每一行调用一次函数，从而极大提高效率。

- 尽量减少全表扫描的次数，特别是大数据量的表。

- 通过`ANALYZE TABLE`定期使用该语句保持表的统计信息保持最新，因此优化器可以构造有效执行计划所需的信息。

- 了解每个表的存储引擎，索引技术和配置参数，InnoDB`和`MyISAM有不同的实现查询高性能。

- 避免难以理解的查询方式，尤其优化器可以自动优化相同的转换。

- 阅读`EXPLAIN`计划,调整索引，WHERE子句，JOIN子句。

- 调整MySQL缓存的内存大小和属性。通过有效的使用InnoDB缓冲池，MyISAM键缓存和MySQL查询缓存，可以使重复的查询更快。

- 处理锁问题，其中多个会话在同一时间访问同一张表，性能会受到影响。



### WHERE子句优化

您可能会想重写查询以使算术运算更快，同时又牺牲了可读性。由于MySQL自动进行类似的优化，因此您通常可以避免这项工作，而将查询保留为更易于理解和维护的形式。MySQL执行的一些优化如下：

- 删除不必要的括号：

  ```mysql
  ((a AND b) AND c OR (((a AND b) AND (c AND d))))
  -> (a AND b AND c) OR (a AND b AND c AND d)
  ```

- 常量合并

  ```mysql
     (a<b AND b=c) AND a=5
  -> b>5 AND b=c AND a=5
  ```

- 常量条件去除

  ```mysql
  (b>=5 AND b=5) OR (b=6 AND 5=5) OR (b=7 AND 5=6)
  -> b=5 OR b=6
  ```

- 索引使用的常量表达式仅计算一次

- `COUNT(*)`单表且没有使用WHERE子句的时候，是可以从MyISAM和内存表中直接获取信息的。同样也适用于查询单表某个NOT NULL的字段。

- 