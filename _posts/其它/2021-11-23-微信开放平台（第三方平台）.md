---
layout: post
title: 微信开放平台（第三方平台）
categories: [其它]
description: 微信开放平台
keywords: 微信开放平台
---

### 第三方平台概述

微信开放平台-第三方平台（简称第三方平台）开放给所有通过[开发者资质认证](https://kf.qq.com/faq/170824URbmau170824r2uY7j.html)的开发者使用。在得到公众号或小程序运营者（简称运营者）[授权](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/Authorization_Process_Technical_Description.html)后，第三方平台开发者可以通过调用微信开放平台的接口能力，为公众号或小程序的运营者**提供账号申请、小程序创建、技术开发、行业方案、活动营销、插件能力等全方位服务**。

#### 使用第三方平台有什么优势？

- 微信官方许可
- 免繁琐设置
- 安全可靠的授权

#### 第三方平台分类

在平台类型上，第三方平台分为平台型和定制化型：

1. 定制化型服务商指的是通过获取商家提供小程序或者公众号的appid和secret进行开发，内容可以完全是商家定制化的，服务商可以将票据埋在小程序中（具体操作请查看[创建定制化型服务商](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/operation/thirdparty/customized_service_platform_guidelines.html)），便于平台识别出该小程序是某个第三方服务商代开发的。定制化型服务商的详细说明文档请点击查看[定制化型服务商说明文档](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/operation/thirdparty/customized_service_platform_guidelines.html)。
2. 平台型服务商指的是可通过第三方平台的authorizer_access_token在获得商家授权后进行代商家小程序/公众号调用相关接口能力进行开发；且如果是小程序，则可以将小程序代码上传托管到第三方平台的小程序模板库中。利用第三方平台的能力，可基于一个模板进行发布多个小程序，有利于服务商批量为商家开发小程序。平台型服务商的授权流程请点击查看[授权技术流程说明](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/Authorization_Process_Technical_Description.html)。

补充，在技术上，第三方平台是通过获得公众号或小程序的接口能力的授权，然后代公众平台帐号调用各业务接口来实现业务的，因此，第三方平台在调用各接口时，必须遵循公众平台运营规范，详见：[《微信公众平台运营规范》](https://mp.weixin.qq.com/cgi-bin/readtemplate?t=business/faq_operation_tmpl&type=info&lang=zh_CN&token=)

#### 该选择平台型还是定制化型？

- 只有平台型第三方平台才提供授权方式，而定制化型通常是通过获取商家提供小程序或者公众号的appid和secret进行开发，因此，若希望能通过商家扫码即可授权给服务商进行代开发代运营，则应当选择平台型第三方

#### 为什么选择扫码方式进行授权？

- 就服务商而言，此种授权方式更加安全和便捷，服务商无需管理多个商家的账号密码或者appid和secret；
- 就商家而言，此种授权方式也更加安全和便捷，商家只需要将部分权限授权给服务商即可；无需将公众号/小程序的账号密码或者appid和secret都交由服务商；且商家可以随时进行解除授权；

#### 平台型第三方平台应用场景

1、为商家提供综合的解决方案，整体打包公众号或小程序的产品开发、运营等；

2、为小程序商家提供小程序代开发服务、代运营服务；

3、为小商店商家提供小商店增值服务；

4、为公众号商家例如提供专门优化图文消息视觉样式和排版的工具，或专门定制的 CRM 用户管理功能、精细化运营用户公众号等；

### 第三方小程序开发模式说明

![img](https://res.wx.qq.com/op_res/bxJyhxwCLPMU5kXnHZPXggc_VVOWN5a9YlHp3SEiJiaqwBGaE0qGe4HKfpnpQUxWBuOJpW7Kfdf8bar68w_1gw)

- 注，绑定开发小程序的操作，请查看[绑定开发小程序](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/operation/thirdparty/dev.html)
- 更多关于第三方平台代开发小程序介绍可查看https://developers.weixin.qq.com/miniprogram/dev/devtools/ext.html
- 上述流程是将代码提交到草稿箱，再到模板库再提交到小程序。如果想实现直接将代码提交到小程序，则可以通过使用 directCommit 直接提交至待审核列表。directCommit是ext.json里的一个参数，详情可查看[extAppid 的开发调试](https://developers.weixin.qq.com/miniprogram/dev/devtools/ext.html)
- 除了通过开发者工具提交代码，还可以通过[miniprogram-ci](https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html)提交代码，directCommit同样适用于ci工具；![img](https://res.wx.qq.com/op_res/8-IA3M33KzsocCbZWoomZXRWb740KnV0uV2Zqk1FNQ1-rynEa6hISp0DPcxv-S_nhVxLR2KUN-CvtNr2aNETaQ)
- 使用第三方代开发模式，重点需要关注ext.json文件的使用，详情可查看https://developers.weixin.qq.com/miniprogram/dev/devtools/ext.html

如上图所示，第三方平台帮助旗下已授权的小程序进行代码管理时，需先开发完成小程序模板，再将小程序模板部署到旗下小程序帐号中，具体流程如下：

##### 第一步：绑定开发小程序

（1）第三方平台的开发人员需先到微信公众平台（mp.weixin.qq.com）申请一个普通的小程序并完善小程序的头像、昵称、简介、服务类目等信息。

（2）进入微信开放平台，在第三方平台详情中，将该小程序添加为**开发小程序**。（注意，绑定为开发小程序后，该小程序在开发工具中上传，代码会直接上传到开放平台，不会上传到公众平台）

##### 第二步：小程序模板的开发和上传

使用开发小程序的开发者微信号登录[微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)，开发者工具中按照正常的小程序开发流程进行代码开发和调试。开发完成后，在开发工具中点击上传。使用详见：[**第三方平台代开发小程序**](https://developers.weixin.qq.com/miniprogram/dev/devtools/ext.html)

##### 第三步：添加到小程序模板库，获得模板 ID

从开发者工具中上传的代码，会先存在草稿箱中，每个开发小程序只保留最新一份上传记录。开发者可将草稿箱中的代码添加到小程序模板库中，小程序模板库中的模板不会被覆盖。最多可以有200个代码模板，添加后可以获得模板 ID（TemplateID）。

小程序模板库分为普通模板库和标准模板库，关于两者的区别可以查看[小程序模板库管理](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/operation/thirdparty/template.html)

##### 第四步：调用接口，为旗下授权的小程序部署代码

具体接口详见[上传代码](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/code/commit.html)

**重点提示：**

- 小程序授权托管之后，只能使用第三方平台的在微信开放平台登记的服务器域名和业务域名。所以第三方平台在帮助旗下小程序发布代码之前，需先把服务器域名和业务域名设置到小程序的服务器域名和业务域名中
- 设置接口详见[设置服务器域名](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Mini_Program_Basic_Info/Server_Address_Configuration.html)和[设置业务域名](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Mini_Program_Basic_Info/setwebviewdomain.html)。

### 授权流程技术说明

#### 整体说明

1、本文涉及的小程序或者公众号授权给第三方平台的技术实现流程仅适用于平台型第三方平台，不适用于定制化型第三方平台。

2、当前提供了三种授权方式，分别是PC版扫码授权、H5版授权及小程序插件版授权，开发者可根据自身业务情况，选择合适的授权方式。

#### 整体步骤

步骤一、调用接口获取预授权码（pre_auth_code），接口详情请查看[api_create_preauthcode](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/ThirdParty/token/pre_auth_code.html)

步骤二、按照官方文档规则生成PC端的授权二维码或者移动端的授权链接，详情请看下方说明

步骤三、公众号/小程序管理员扫码或者访问移动端授权链接，确认同意授权给第三方平台

步骤四、管理员授权确认之后，授权页会自动跳转进入回调 URI，并在 URL 参数中返回授权码和过期时间(redirect_url?auth_code=xxx&expires_in=600)

步骤五、调用接口生成[authorizer_access_token](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/ThirdParty/token/api_authorizer_token.html)，然后以该token调用公众号或小程序的相关 API

#### 补充说明

- 能调用哪些 API，取决于用户将哪些权限集授权给了第三方平台型服务商，也取决于公众号或小程序自身拥有哪些接口权限，使用 JS SDK 等能力
- 如果商家需要解除授权，则需要登录[公众平台](https://mp.weixin.qq.com/)进行操作；当前不支持第三方服务商主动解除授权
- 如果小程序/公众号管理员只想取消对服务商的个别权限集的授权，则可以重新扫码进入授权页面，然后自定义权限集，重新授权即可
- 第三方平台有需要时可以增加新的权限，以满足新的业务需求。修改后新授权的公众号/小程序授权时会增加新权限的申请，已授权的老用户，旧有权限不影响，但新权限集需要其升级授权后才可获得
- 权限集只可以授权给公众号或者普通小程序和小商店，其他类型的账号暂时不支持。可通过[api_get_authorizer_info](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/ThirdParty/token/api_get_authorizer_info.html)查看账号的类型。

### 接口文档（TODO）





