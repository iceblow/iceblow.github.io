---
layout: post
title: 2022年面试准备
categories: [面试]
description: 面试
keywords: 面试, keyword2
---

为了准备面试，写下本文记录关键信息。

### 自我介绍

大家好，我叫XXX，从事java开发有10年工作经验。最近就职于上海蟠龙信息科技有限公司，担任研发经理职位。

公司是做线上零售业务，我们开发了运营系统、内部信息化系统、微信第三方平台、微信支付、BI可视化分析工具等，个人负责需求分析、架构设计、技术选型、功能开发、运维等。技术栈包括Springcloud alibaba微服务框架、redis、es、metabase等。

上一家公司是在科大讯飞消费者BG，担任研发组长，我们做了听见字幕的产品，个人负责听见字幕的架构优化、重构、功能研发等，技术栈有Springcloud微服务框架、rocketmq等。

之前还在谊品生鲜做了谊品到家小程序，包括用户服务、权限服务、商户服务、营销服务（拼团秒杀）等，技术栈包括dubbo、grpc微服务框架、pulsar消息系统、Apollo配置中心等。

擅长并发编程，数据库设计和调优，架构设计，项目管理等工作，业余时间学习架构知识、源码，并沉淀学习心得。

### 多线程

#### AQS

抽象类`AbstractQueuedSynchronizer`。

### Spring原理

### 秒杀系统

| 设计方案     | 实现                                                 |
| ------------ | ---------------------------------------------------- |
| 独立部署     | 独立web服务器，后台服务、独立域名                    |
| 页面设计简单 | 简化页面商品信息                                     |
| 多级缓存     | 浏览器或APP缓存、CDN缓存、服务端本地缓存、分布式缓存 |
| 下单限流     | 全局下单计数器（redis实现）                          |

### 微服务框架

#### Springcloud、dubbo比较

| 功能组件 | Spring Cloud                   | Dubbo                                              |
| -------- | ------------------------------ | -------------------------------------------------- |
| 底层协议 | Http协议Rest接口通信           | Netty NIO框架，TCP协议，Hession序列化完成RPC通信， |
| 性能     | 报文更大占用带宽大，但rest灵活 | 性能较好，但强依赖                                 |

#### 服务治理





#### 组件原理

### 架构设计

#### 架构图

<img src="https://gitee.com/dxyin/pic/raw/master/20220318152323.png" alt="image-20220318152323719" style="zoom: 33%;" />

### 数据结构和算法

#### 限流算法

| 限流算法 | 原理                                   | 优点                       | 缺点                               | 场景                       |
| -------- | -------------------------------------- | -------------------------- | ---------------------------------- | -------------------------- |
| 固定窗口 | 统计一个周期内的请求量                 | 实现简单                   | 临界点问题                         | 普通限流                   |
| 滑动窗口 | 一个周期分为多个小窗口                 | 限流粒度较细               | 临界点问题，实现稍复杂             | 普通限流                   |
| 漏桶     | 桶里是请求，总量控制                   | 桶大小可控，可应对突发流量 | 无法精确控制流出速度               | 秒杀                       |
| 令牌桶   | 桶里是令牌，请求从桶里拿令牌，速率控制 | 速率可控                   | 突发大流量会丢弃许多请求，实现复杂 | 平稳限流，如访问第三方服务 |

### Redis

#### 持久化

| 持久化方式 | 原理                                                        | 优点                                         | 缺点                               |
| ---------- | ----------------------------------------------------------- | -------------------------------------------- | ---------------------------------- |
| RDB        | 定期快照存储                                                | 速度快，适合备份                             | 丢失部分数据，fork的子线程占用内存 |
| AOF        | 追加写，记录每次对服务器写的操作                            | 数据完整                                     | 文件体积大，速度慢                 |
| 混合模式   | 内存快照以⼀定的频率执⾏，在两次快照之间，使⽤ AOF ⽇志记录 | 不会出现⽂件过⼤的情况了，也可以避免重写开销 |                                    |

#### zset有序集合

跳表是链表加多级索引的结构，原理是单向链表的二分查找。

<img src="https://static001.geekbang.org/resource/image/a8/a7/a861445d0b53fc842f38919365b004a7.jpg" alt="img" style="zoom: 33%;" />

#### 部署方式

| 部署方式 | 原理                                                         | 缺点                                 |
| -------- | ------------------------------------------------------------ | ------------------------------------ |
| 单机     |                                                              |                                      |
| 主从     | 主从读写分离：<br>主从均可读<br>写交给主库，然后同步到从库（全量、增量） | 主库挂了不能提供写，故障不能自动转移 |
| 哨兵     | 哨兵集群：哨兵是⼀个运⾏在特殊模式下的 Redis 进程<br>监控:周期性地给所有的主从库发送 PING 命令<br/>选举:主观客观下线、筛选打分三轮选主(优先级、同步最接近、ID最小）<br/>通知: 从库同步新主库，原主库下线 |                                      |
| 集群     | ⽤哈希槽来处理数据和实例之间的映射关系,key使用crc16算法对16384取模后定位到槽<br/>客户端缓存hash槽信息，重定向机制move |                                      |

#### 渐进式Hash

Redis 默认使⽤了两个全局哈希表：哈希表12。默认使⽤ 1， 2 并没有被分配空间。随着数据逐步增多，Redis 开始执⾏ rehash

- 给哈希表 2 分配更⼤的空间
- 把哈希表 1 中的数据重新映射并拷⻉到哈希表 2 中（渐进式，只写入新表，先查老表查不到再查新表）
- 释放哈希表 1 的空间

#### LRU缓存淘汰算法

自己实现：单向链表，头部放最新数据。判断是否新数据（遍历是否存在），如果已存在，删除所在的节点，然后放在头节点；如果是新数据，判断是否有内存，没有的话就删除尾部节点，新数据都是放在头节点的。

### Mysql

#### B+树

特点：m 叉树只存储索引（非叶子节点），并不真正存储数据，通过链表将叶子节点串联在一起，这样可以方便按区间查找。

IO次数取决于b+数的高度h，当前数据表的数据为N，每个磁盘块的数据项的数量是m = 磁盘块的大小 / 数据项的大小（m 值是根据页的大小事先计算好的，也就是说，每个节点最多只能有 m 个子节点）。

3层的b+树可以表示上百万的数据。

![公式](https://gitee.com/dxyin/pic/raw/master/20220321095252.png)

### Zookeeper

#### 原理

分布式协调解决方案，提供

#### 分布式锁

排它锁：在lock节点下创建临时子节点 ，只有一个客户端创建成功获取锁，未获取锁的节点同时在lock节点下创建子节点的watch变更事件，可以重新获取锁。

共享锁：创建临时顺序节点，对于写请求，如果自己不是序号最小的子节点，那么就进入等待；对于读请求如果所有比自己小的子节点都是读请求可以获取锁。

### 系统排查

